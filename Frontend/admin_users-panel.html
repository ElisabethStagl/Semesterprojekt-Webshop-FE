<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Users</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 8px 12px;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>

<h2>Admin Panel - User List</h2>

<div id="admin-content" style="display:none;"> <!-- Initially hidden until validated -->
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Sex</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Address</th>
                <th>Door Number</th>
                <th>Postal Code</th>
                <th>City</th>
                <th>Email</th>
                <th>Username</th>
                <th>Role</th>
            </tr>
        </thead>
        <tbody id="userTableBody">
            <!-- Data will be populated here dynamically -->
        </tbody>
    </table>
</div>

<div id="error-message" style="display:none; color: red;"> <!-- Error message area -->
    Access Denied! You do not have permission to view this content.
</div>

<script>
    function getAuthHeaders() {
        const token = localStorage.getItem('jwtToken');
        if (!token) {
            alert('Not authenticated!');
            window.location.href = 'login.html'; // Redirect to login or other appropriate page
            return {};
        }
        return {
            'Authorization': 'Bearer ' + token
        };
    }

    function handleResponse(response) {
        if (!response.ok) {
            throw new Error('Network response was not ok: ' + response.statusText);
        }
        return response.json();
    }

    // First, fetch the current user details
    fetch("http://localhost:8080/users/current-user", {
        method: "GET",
        headers: getAuthHeaders()
    })
    .then(handleResponse)
    .then(currentUser => {
        if (currentUser.role === "ROLE_ADMIN") {
            return fetch("http://localhost:8080/admin/users", {
                headers: getAuthHeaders()
            });
        } else {
            throw new Error('User is not an admin');
        }
    })
    .then(handleResponse)
    .then(users => {
        const tableBody = document.getElementById('userTableBody');
        users.forEach(user => {
            const row = tableBody.insertRow();
            row.insertCell().textContent = user.id;
            // ... (populate other cells similarly) ...

            // Once data is populated, display the content
            document.getElementById('admin-content').style.display = 'block';
        });
    })
    .catch(error => {
        console.error('Error:', error.message);
        document.getElementById('error-message').style.display = 'block';
    });
</script>


</body>
</html>
